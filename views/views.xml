<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>
        <record model="ir.ui.view" id="catax_catax_form">
            <field name="name">Reporte Ciudadano CMAS</field>
            <field name="model">catax.catax</field>
            <field name="arch" type="xml">
                <form>
                    <style>
                        .o_form_sheet {
                            max-width: 90% !important;
                            }

                          [name*="medio_reporte"] > option:last-child {
                              display: none;
                          }

                          .o_field_widget.o_priority {
                              pointer-events: none;
                          }

                          [name*="evidencia_atencion"] table thead th {
                              width: 50%;
                          }

                          .btnXalapa {
                              color: #a53420;
                              font-weight: bold;
                              cursor: pointer;
                              border: 1px solid #a53420;
                              border-radius: 6px;
                              padding: 6px;
                              height: 34px;
                              background-color: white;
                              width: 120px;
                              text-align: center;
                          }
                          .btnXalapa:hover{
                            background-color: #a53420 !important;
                            color: white !important;
                          }
                    </style>
                    <header>
                        <field name="estatus" widget="statusbar"/>
                        <button string="En proceso" type="object" name="change_estatus" class="oe_highlight oe_read_only" context="{'estatus': 'enproceso'}" attrs="{'invisible': [('estatus', 'in', ['enproceso','ATEN'])]}" confirm="¿Desea pasar el reporte a en proceso?" groups="catax.cmas_analista,catax.tala_analista,catax.obra_analista,catax.parq_analista,catax.rrsu_analista,catax.otro,catax.arbo_analista,catax.alum_analista,catax.reclamacion_dan,catax.protec_ent_eco,catax.protec_ent_eco_ejecutivo,catax.reclamacion_dan_ejecutivo,catax.alum_ejecutivo,catax.arbo_ejecutivo,catax.otro_ejecutivo,catax.rrsu_ejecutivo,catax.parq_ejecutivo,catax.obra_ejecutivo,catax.tala_ejecutivo,catax.sipinna,catax.sipinna_ejecutivo,catax.movilidad_urbana_ejecutivo,catax.movilidad_urbana,catax.inspeccion_contrucciones_ejecutivo,catax.inspeccion_contrucciones,catax.dif_ejecutivo,catax.dif,catax.mercados_ejecutivo,catax.mercados,catax.covp_ejecutivo,catax.covp,catax.coes_ejecutivo,catax.coes,catax.proteccion_civil_ejecutivo,catax.proteccion_civil,catax.comu_ejecutivo,catax.comu_analista,catax.reci_ejecutivo,catax.reci_analista,catax.segu_ejecutivo,catax.segu_analista" />
                        <button string="Atendido" type="object" name="change_estatus" class="oe_highlight oe_read_only" context="{'estatus': 'ATEN'}" attrs="{'invisible': [('estatus', 'in', ['R','ATEN'])]}" confirm="¿Desea pasar el reporte a atendido?"                  groups="catax.cmas_analista,catax.tala_analista,catax.obra_analista,catax.parq_analista,catax.rrsu_analista,catax.otro,catax.arbo_analista,catax.alum_analista,catax.reclamacion_dan,catax.protec_ent_eco,catax.protec_ent_eco_ejecutivo,catax.reclamacion_dan_ejecutivo,catax.alum_ejecutivo,catax.arbo_ejecutivo,catax.otro_ejecutivo,catax.rrsu_ejecutivo,catax.parq_ejecutivo,catax.obra_ejecutivo,catax.tala_ejecutivo,catax.sipinna,catax.sipinna_ejecutivo,catax.movilidad_urbana_ejecutivo,catax.movilidad_urbana,catax.inspeccion_contrucciones_ejecutivo,catax.inspeccion_contrucciones,catax.dif_ejecutivo,catax.dif,catax.mercados_ejecutivo,catax.mercados,catax.covp_ejecutivo,catax.covp,catax.coes_ejecutivo,catax.coes,catax.proteccion_civil_ejecutivo,catax.proteccion_civil,catax.comu_ejecutivo,catax.comu_analista,catax.reci_ejecutivo,catax.reci_analista,catax.segu_ejecutivo,catax.segu_analista"/>
                        <button string="Recanalizado" type="object" name="change_canalizado" class="oe_highlight oe_read_only" context="{'recanalizar': False}" attrs="{'invisible': [('recanalizar', '!=', True)]}" confirm="¿Desea finalizar la recanalización del registro?" groups="catax.operador,catax.protec_ent_eco_ejecutivo,catax.reclamacion_dan_ejecutivo,catax.alum_ejecutivo,catax.arbo_ejecutivo,catax.otro_ejecutivo,catax.rrsu_ejecutivo,catax.parq_ejecutivo,catax.obra_ejecutivo,catax.tala_ejecutivo,catax.sipinna_ejecutivo,catax.movilidad_urbana_ejecutivo,catax.inspeccion_contrucciones_ejecutivo,catax.dif_ejecutivo" />
                    </header>
                    <sheet>
                      <notebook>
                        <page string="Reporte Ciudadano CMAS">                        
                          <group>
                            <group>
                              <field name="is_operador" invisible="1"/> 
                              <field name="is_analist" invisible="1"/> 
                              <field name="permisos_extendidos_operador" invisible="1"/> 
                              <field name="folio_report" readonly="1"/> 
                            </group>
                            
                            <group>
                              <field name="create_date" string="Fecha de creación" readonly="1"/> 
                                                          
                            </group>
                          </group>
                          <group>
                              <group>
                                <field name="categoria" domain="[('activo','!=', False)]" attrs="{'readonly': ['&amp;','|',('is_analist','=',True),('estatus','=','ATEN'),'&amp;',('is_operador','=',False),('is_analist','=',True)]}"/>
                                <field name="cve_categoria" invisible="1" readonly="1"/>
                                <field name="sub_categoria"  domain="[('categoria','=', categoria)]" attrs="{'readonly': ['&amp;','|', '|', ('estatus','=','ATEN') , '&amp;',('is_analist','=',True),('estatus','=','enproceso'),'&amp;',('is_analist','=',True),('medio_reporte','=','W'),'&amp;',('is_operador','=',False),('is_analist','=',True) ]}"/>       
                                <field name="cve_subcategoria" invisible="1" readonly="1"/>                                
                                <field name="telefono" attrs="{'readonly': ['|',('estatus','!=','R'),('medio_reporte','=','W')]}" />   
                                <field name="correo" attrs="{'readonly': ['|',('estatus','!=','R'),('medio_reporte','=','W')]}" />   
                              </group>
                              <group>                                
                                <field name="medio_reporte" attrs="{'readonly': ['|',('estatus','!=','R'),('medio_reporte','=','W')]}" /> 
                                <field name="redsocial" attrs="{'invisible' : [('medio_reporte','!=', 'R')], 'readonly': ['|',('estatus','!=','R'),('medio_reporte','=','W')] }" />   
                                <field name="filename_oficio_reporte"  invisible="1" attrs="{'readonly': ['|',('estatus','!=','R'),('medio_reporte','=','W')]}"/>   
                                <field name="oficio_reporte" filename="filename_oficio_reporte" attrs="{'invisible' : [('medio_reporte','!=', 'O')] , 'readonly': ['|',('estatus','!=','R'),('medio_reporte','=','W')]}"  />
                              </group>
                          </group>
                          <t name="catax_catax_form" >
                              <t t-call="website.layout">
                                  <link rel="stylesheet" href="/catax/static/src/js/ol.css"/>
                                  <div id="map" class="map" style="height: 600px; width: 100%;"></div>
                                  <script type="text/javascript" src="/catax/static/src/js/ol.js"/>
                                  <script type="text/javascript" src="/catax/static/src/js/ol_layout260721.js"/>
                              </t>
                          </t>
                          <group string="Ubicación del reporte">
                            <group class="direccion_find">
                              <field name="colonia" class="colonia" attrs="{'readonly': ['|',('estatus','!=','R'),('medio_reporte','=','W')]}" /> 
                              <field name="calle" class="calle" attrs="{'readonly': ['|',('estatus','!=','R'),('medio_reporte','=','W')]}" /> 
                              <field name="no_exterior" class="no_ext" attrs="{'readonly': ['|',('estatus','!=','R'),('medio_reporte','=','W')]}"/> 
                              <field name="no_interior" class="no_int" attrs="{'readonly': ['|',('estatus','!=','R'),('medio_reporte','=','W')]}"/> 
                              <field invisible="1" name="cp" class="cp" attrs="{'readonly': ['|',('estatus','!=','R'),('medio_reporte','=','W')]}"/> 
                              <field name="referencia" class="ref" attrs="{'readonly': ['|',('estatus','!=','R'),('medio_reporte','=','W')]}"/>
                            </group>
                            <group>
                              <field name="latitud" class="lat" invisible="1" attrs="{'readonly': ['|',('estatus','!=','R'),('medio_reporte','=','W')]}"/>
                              <field name="longitud" class="lon" invisible="1" attrs="{'readonly': ['|',('estatus','!=','R'),('medio_reporte','=','W')]}" />
                              <field name="address" invisible="1" attrs="{'readonly': ['|',('estatus','!=','R'),('medio_reporte','=','W')]}"/>
                            </group>
                          </group>
                          
                          <group string="Datos del reporte">
                            <group>             
                                <field name="descripcion_reporte" attrs="{'readonly': ['|',('estatus','!=','R'),('medio_reporte','=','W')]}"/>            
                            </group>
                            <group>
                              <field name="fotografiaReporte" widget="image" style="width:100%;" attrs="{'readonly': ['|',('estatus','!=','R'),('medio_reporte','=','W')]}"/> 
                            </group>
                          </group>
                          <group>
                            <field name="observaciones" attrs="{'readonly': ['|',('is_operador','=',False), ('estatus','=','ATEN')]}"/>  
                          </group> 
                          <notebook>
                            
                              
                           
                            <page string="Comentarios de apoyo al reporte" autofocus="autofocus">
                              <group>
                                <field name="comentarios_reporte" readonly="1" nolabel="1" >
                                  <tree editable="bottom">
                                    <field name="comentarios"/>
                                  </tree>
                                </field>            
                              </group>
                              <group>
                                <field name="cant_coment_apoyo" string="Cantidad de comentarios de apoyo" readonly="1"/>   
                              </group>
                              
                            </page>
                          </notebook>
                          <group string="Atención y seguimiento." >
                            <group>
                              <field name="area_categoria" domain="[('id_categoria','=', categoria)]" attrs="{'readonly': ['|','|','|',('is_analist', '=', 'False'),('estatus', '=', 'ATEN') , '&amp;',  ('permisos_extendidos_operador', '=', True),('cve_categoria', '!=', 'PROC'), '&amp;' , ('is_operador','=',True),('permisos_extendidos_operador','=',False)]}" />
                              <field name="id_depto_aux" readonly="1" invisible="1"/>
                              <field name="responsable_area" domain="[('department_id.id','=', id_depto_aux)]" attrs="{'readonly': ['|','|','|',('is_analist', '=', 'False'),('estatus', '=', 'ATEN') , '&amp;',  ('permisos_extendidos_operador', '=', True),('cve_categoria', '!=', 'PROC'), '&amp;' , ('is_operador','=',True),('permisos_extendidos_operador','=',False)]}"  />
                              <field name="prioridad_reporte" attrs="{'readonly': ['|','|','|',('is_analist', '=', 'False'),('estatus', '=', 'ATEN') , '&amp;',  ('permisos_extendidos_operador', '=', True),('cve_categoria', '!=', 'PROC'), '&amp;' , ('is_operador','=',True),('permisos_extendidos_operador','=',False)]}" />
                              <field name="comentario_seguimiento" attrs="{'readonly': ['|','|','|',('is_analist', '=', 'False'),('estatus', '=', 'ATEN') , '&amp;',  ('permisos_extendidos_operador', '=', True),('cve_categoria', '!=', 'PROC'), '&amp;' , ('is_operador','=',True),('permisos_extendidos_operador','=',False)]}" />
                              <field name="comentario_area" attrs="{'readonly': ['|','|','|',('is_analist', '=', 'False'),('estatus', '=', 'ATEN') , '&amp;',  ('permisos_extendidos_operador', '=', True),('cve_categoria', '!=', 'PROC'), '&amp;' , ('is_operador','=',True),('permisos_extendidos_operador','=',False)]}" />
                            </group>

                            

                            <group>
                              <field name="cerrar_atencion" attrs="{'readonly': ['|','|','|',('is_analist', '=', 'False'),('estatus', '=', 'ATEN') , '&amp;',  ('permisos_extendidos_operador', '=', True),('cve_categoria', '!=', 'PROC'), '&amp;' , ('is_operador','=',True),('permisos_extendidos_operador','=',False)]}" /> 
                              <field name="fecha_estimada" attrs="{'readonly': ['|','|','|',('is_analist', '=', 'False'),('estatus', '=', 'ATEN') , '&amp;',  ('permisos_extendidos_operador', '=', True),('cve_categoria', '!=', 'PROC'), '&amp;' , ('is_operador','=',True),('permisos_extendidos_operador','=',False)]}" /> 
                              <field name="fecha_finalizada" readonly="1" /> 
                              <field name="recanalizar" widget="checkbox" attrs="{'readonly': ['|','|','|',('is_analist', '=', 'False'),('estatus', '=', 'ATEN') , '&amp;',  ('permisos_extendidos_operador', '=', True),('cve_categoria', '!=', 'PROC'), '&amp;' , ('is_operador','=',True),('permisos_extendidos_operador','=',False)]}" />
                              <field name="solicitar_intervencion_catastro" widget="checkbox" attrs="{'readonly': ['|','|','|',('is_analist', '=', 'False'),('estatus', '=', 'ATEN') , '&amp;',  ('permisos_extendidos_operador', '=', True),('cve_categoria', '!=', 'PROC'), '&amp;' , ('is_operador','=',True),('permisos_extendidos_operador','=',False)]}" />

                            </group>

                            

                          </group>

                           <group string="Evidencia de atención" attrs="{'readonly': ['|','|','|',('is_analist', '=', 'False'),('estatus', '=', 'ATEN') , '&amp;',  ('permisos_extendidos_operador', '=', True),('cve_categoria', '!=', 'PROC'), '&amp;' , ('is_operador','=',True),('permisos_extendidos_operador','=',False)]}" >
                                <field name="evidencia_atencion"  mode="tree" attrs="{'readonly': ['|','|','|',('is_analist', '=', 'False'),('estatus', '=', 'ATEN') , '&amp;',  ('permisos_extendidos_operador', '=', True),('cve_categoria', '!=', 'PROC'), '&amp;' , ('is_operador','=',True),('permisos_extendidos_operador','=',False)]}" >
                                  <tree editable="bottom">
                                    <field name="nombre_archivo" required="1"/>
                                    <field name="evidencia" widget="binary" filename="filename" required="1"/>
                                    <field name="filename" invisible="1" />
                                  </tree>
                                </field>
                            </group>
                          

                          <group string="Valoración" groups="base.group_system,catax.protec_ent_eco_ejecutivo,catax.reclamacion_dan_ejecutivo,catax.alum_ejecutivo,catax.arbo_ejecutivo,catax.otro_ejecutivo,catax.rrsu_ejecutivo,catax.parq_ejecutivo,catax.obra_ejecutivo,catax.tala_ejecutivo,catax.operador_ejecutivo,catax.sipinna_ejecutivo,catax.cmas_ejecutivo,catax.movilidad_urbana_ejecutivo,catax.inspeccion_contrucciones_ejecutivo,catax.dif_ejecutivo,catax.mercados_ejecutivo,catax.covp_ejecutivo,catax.coes_ejecutivo,catax.proteccion_civil_ejecutivo,catax.comu_ejecutivo,catax.reci_ejecutivo,catax.segu_ejecutivo,catax.lectura">
                            <group>
                                <field name="calificacion_atencion" widget="priority"/>   
                              </group>
                              <group>
                                <field name="calificacion_reporte" widget="priority"/>   
                              </group>
                              <group>
                                <field name="comentarios_reportante" />   
                              </group>

                          </group>

                        </page>
                        <page string="Historial de asignaciones"  groups="base.group_system"> 
                          <field name="historial_asignaciones">
                            <tree default_order='create_date desc'>
                              <field name="categoria" />
                              <field name="sub_categoria" />                            
                              <field name="area_asignada" />
                              <field name="responsable_area" />
                              <field name="comentario_seguimiento" />
                              <field name="comentario_area" />
                              <field name="create_uid" string="Creado por"/>
                              <field name="create_date" string="Fecha de creación"/>
                            </tree>
                          </field>
                        </page> 
                      </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- Tree configuracion documental-->
        <record id="catax_catax_tree" model="ir.ui.view">
            <field name="name">Listado de reportes</field>
            <field name="model">catax.catax</field>
            <field name="arch" type="xml">
                <tree default_order="create_date desc">
                  <field name="folio_report" />  
                  <field name="create_date"  string="Fecha de creación"/>
                  <field name="categoria" />
                  <field name="sub_categoria" />
                  <field name="desc_report_cort" />                            
                  <field name="estatus"/>
                  <field name="create_uid" string="Creado por"/>
                </tree>
            </field>
        </record>

        <record id="graph_catax" model="ir.ui.view">
          <field name="name">Gráficas Reporte Ciudadano CMAS</field>
          <field name="model">catax.catax</field>
          <field name="arch" type="xml">
            <graph string="Estatus de reportes" type="bar" stacked="True">
              <field name="categoria"/>
              <field name="estatus"/>
            </graph>
          </field>
        </record>

        <!-- Accion configuracion documental -->
        <record id="catax_action" model="ir.actions.act_window">
            <field name="name">Reporte Ciudadano CMAS</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">catax.catax</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,graph</field>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    Pulse aquí para agregar un RFC.
                </p>
            </field>
        </record>

        <record id="catax_catax_view_tree" model="ir.actions.act_window.view">
            <field name="sequence" eval="0"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="catax_catax_tree"/>
            <field name="act_window_id" ref="catax_action"/>
        </record>

        <record id="catax_catax_view_form" model="ir.actions.act_window.view">
            <field name="sequence" eval="1"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="catax_catax_form"/>
            <field name="act_window_id" ref="catax_action"/>
        </record>

        <record id="catax_catax_view_graph" model="ir.actions.act_window.view">
            <field name="sequence" eval="2"/>
            <field name="view_mode">graph</field>
            <field name="view_id" ref="graph_catax"/>
            <field name="act_window_id" ref="catax_action"/>
        </record>

        <!-- <record model="ir.ui.view" id="catax_custom_kanban">
          <field name="name">Estadistica de reportes</field>
          <field name="model">hr.department</field>
          <field eval="200" name="priority"/>
          <field name="arch" type="xml">
            <kanban create="false">
              <field name="name"/>
              <field name="request_total_catax"/>
              <field name="request_resolved_catax"/>
              <templates>
                <t t-name="kanban-box">
                  <div class="oe_module_vignette">
                    <div class="oe_module_desc">
                      <h3 class="o_kanban_record_title" style="font-size: 16px;">Area asignada:</h3>
                      <p class="oe_module_name" style="font-size: 14px">
                        <field name="name"/>
                        <br/>
                      </p>
                      <field name="request_resolved_catax" widget="gauge_extend" options="
                                             {'max_field': 'request_total_catax',
                                              'type': 'percent',
                                              'style': 'width:160px; height: 120px; margin: 5px auto; display: block !important;',
                                              'bottom_font_size': 12,
                                              'boundary_font_size': 10,
                                              'show_portion': True}" />
                    </div>
                  </div>
                </t>
              </templates>
            </kanban>
          </field>
        </record> -->

        <record id="action_catax_panel_control_action_window" model="ir.actions.server">
          <field name="name">Panel de control</field>
          <field name="condition">True</field>
          <field name="type">ir.actions.server</field>
          <field name="model_id" ref="model_catax_catax"/>
          <field name="state">code</field>
          <field name="code">action = model.panel_control(model._context)</field>
        </record>

    <record model="ir.actions.act_window" id="action_catax_recanalizar">
      <field name="name">Reportes re-canalizar</field>
      <field name="res_model">catax.catax</field>
      <field name="view_mode">tree,form</field>
      <field name="domain">[('recanalizar','=',True)]</field>
    </record>

    <!-- Generar reportes -->
        <record model="ir.ui.view" id="catax.reportes">
            <field name="name">Generar reportes</field>
            <field name="model">catax.reportes</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Generar informe" create="false" edit="false">
                    <group>
                        <p>Genera un informe con los datos de los registros de Reporte Ciudadano CMAS.</p>
                    </group>
                    <group>
                        <field name="tipo_reporte" widget="radio" required="1"/> 
                        <field name="reporte_oficial" widget="radio" required="1" attrs="{'invisible' : [('tipo_reporte','!=', 'C')]}" groups="base.group_system" />                                                
                    </group>
                    <group string='Rango de fechas' attrs="{'invisible' : [('tipo_reporte','!=', 'T')]}">
                      <group> 
                        <field name="fecha_ini" attrs="{'invisible' : [('tipo_reporte','!=', 'T')]}" />
                      </group>
                      <group>
                        <field name="fecha_fin" attrs="{'invisible' : [('tipo_reporte','!=', 'T')]}" />
                      </group>
                    </group>
                    <footer>
                        <button string="Generar informe" name="generate_report_catax" type="object"
                                class="oe_highlight"/>
                        <button string="Cancelar" special="cancel"/>
                    </footer>
                </form>
            </field>
        </record>
    <record model="ir.actions.act_window" id="action_reportes_catax">
      <field name="name">Generar informe</field>
      <field name="res_model">catax.reportes</field>
      <field name="target">new</field>
      <field name="view_mode">form</field>
    </record>

<!--******************************************************************************************************-->

        <!-- Top menu item -->
        <menuitem name="Reporte Ciudadano CMAS" id="catax.menu_root" sequence="2" groups="catax.operador,catax.operador_ejecutivo,catax.lectura" />
        <menuitem name="Reporte Ciudadano CMAS"    id="catax_menu"         sequence="1" parent="catax.menu_root" groups="catax.operador,catax.operador_ejecutivo,catax.lectura" />
        <menuitem name="Reportes" id="reporte_catax_menu" sequence="1" parent="catax_menu" action="catax_action"/>
        <menuitem name="Recanalizar reportes" id="recanalizadar"   parent="catax_menu" action="action_catax_recanalizar" groups="catax.operador,catax.operador_ejecutivo"/>
        <menuitem name="Generar informe" id="generar_reportes_catax" parent="catax_menu" action="action_reportes_catax" groups="base.group_system,catax.operador_ejecutivo" />
        <!-- menu categories groups="configsolicitudes.contralor,configsolicitudes.analista"
        <menuitem name="Estadísticas de efectividad" id="estadistica_catax_menu" parent="catax_menu" action="action_catax_panel_control_action_window" />-->
  </data>
</odoo>